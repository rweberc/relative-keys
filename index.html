<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relative Tones Practice</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f0f0;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .input-container {
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 500px;  /* Adjust as needed */
            margin: 0 auto;
        }

        .input-container select, .input-container input[type="range"] {
            flex: 1;
            margin-left: 20px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .section-divider {
            height: 2px; /* Adjust as needed */
            background-color: #ccc; /* Adjust as needed */
            width: 350px; /* Adjust as needed */
            margin: 20px auto; /* Adjust as needed */
        }

        .sub-section-divider {
            height: 2px; /* Adjust as needed */
            background-color: whitesmoke; /* Adjust as needed */
            width: 100px; /* Adjust as needed */
            margin: 20px auto; /* Adjust as needed */
        }

        select, checkbox, input[type="range"] {
            flex: 1;
            margin-right: 10px;
            margin-top: 5px;
            margin-bottom: 5px;
            padding: 10px;
            font-size: 16px;
            border: none;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            align-items: center;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            vertical-align: middle;
        }
        
        input[type="range"] {
            /* Cross-browser compatibility */
            -webkit-appearance: none; /* Hides the default slider so that custom slider can be created */
            width: 100%; /* Specific width is required for Firefox. */

            /* For IE */
            height: 15px; /* Specified height */
            background: #ddd; /* Grey background */
            /* outline: none; /* Remove outline */
            opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
            -webkit-transition: .2s; /* 0.2 seconds transition on hover */
            transition: opacity .2s;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; /* Override default look */
            appearance: none;
            width: 25px; /* Set a specific slider handle width */
            height: 25px; /* Slider handle height */
            background: #a09fa5; /* Green background */
            cursor: pointer; /* Cursor on hover */
            /* border-radius: 50%; Circular slider handle */
            margin-top: -0px; /* You need to specify a margin for Chrome, but it can be whatever you want */
        }

        input[type="range"]::-moz-range-thumb {
            width: 25px; /* Set a specific slider handle width */
            height: 25px; /* Slider handle height */
            background: #a09fa5; /* Green background */
            cursor: pointer; /* Cursor on hover */
            /* border-radius: 50%; Circular slider handle */
        }

        button {
            /* background-color: gray; #4CAF50;  */
            /* border: none; */
            /* color: white; */
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
            transition-duration: 0.4s;

        }
/*
        button:hover {
            background-color: #45a049; 
            color: white;
        } */

        .piano {
            /* display: flex;
            justify-content: space-between; */
            display: flex;
            justify-content: center;
            /* align-items: center; */
            /* height: 100%; */
        }

        .white-key, .black-key {
            flex: 1;
            /* margin: 0 5px; */
            height: 100px;
            /* border-radius: 5px; */
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            /* align-items: center; */
            /* justify-content: center; */
            cursor: pointer;
            color: gold;
            /* font-size: 4vw; */
            position: relative;
            cursor: pointer;
        }

        .black-key {
            background-color: slategray;
            color: #fff;
            height: 65px; /* Adjust as needed */
            /* margin-top: 20px; Adjust as needed */
            margin-left: -6.5vw;
            margin-right: -6.5vw;
            width: 3vw;
            z-index: 1;
        }

        .white-key {
            z-index: 0;
            width: 3vw;
            background-color:whitesmoke;
        }

        .white-key.active, .black-key.active {
            background-color: lightcoral;
        }

        .solfege {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            color: gold;
            font-size: 2.5vw;
            margin-bottom: 3px
        }
        .tabs {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .tab-button {
            flex: 1;
            padding: 10px;
            font-size: 16px;
            border: none;
            background-color: #f0f0f0;
            cursor: pointer;
        }

        .tab-button.active {
            background-color: #ddd;
        }

        .tab-content {
            display: none;
            margin-top: 20px;
        }

        .tab-content.active {
            display: block;
        }


    </style>
</head>
<body>
    <div class="piano">
        <div class="white-key" onclick="toggleNote(0, this)"><span class="solfege">do</span></div>
        <div class="black-key" onclick="toggleNote(1, this)"><span class="solfege">di</span></div>
        <div class="white-key active" onclick="toggleNote(2, this)"><span class="solfege">re</span></div>
        <div class="black-key" onclick="toggleNote(3, this)"><span class="solfege">ri</span></div>
        <div class="white-key active" onclick="toggleNote(4, this)"><span class="solfege">mi</span></div>
        <div class="white-key active" onclick="toggleNote(5, this)"><span class="solfege">fa</span></div>
        <div class="black-key" onclick="toggleNote(6, this)"><span class="solfege">fi</span></div>
        <div class="white-key active" onclick="toggleNote(7, this)"><span class="solfege">sol</span></div>
        <div class="black-key" onclick="toggleNote(8, this)"><span class="solfege">si</span></div>
        <div class="white-key active" onclick="toggleNote(9, this)"><span class="solfege">la</span></div>
        <div class="black-key" onclick="toggleNote(10, this)"><span class="solfege">li</span></div>
        <div class="white-key active" onclick="toggleNote(11, this)"><span class="solfege">ti</span></div>
        <!-- <div class="white-key" onclick="toggleNote(12, this)"></div> -->
    </div>

    <div class="input-container"><p><button id="transport-button">Play</button></p></div>

    <div class="input-container"><p id="current-note">Current solfege note(s): . . .</p></div>
    <div class="input-container"><p id="current-key">Current key playing: . . .</p></div>
    <div class="input-container"><p id="current-mode">Current mode playing: . . .</p></div>
    <div class="tabs">
        <button class="tab-button active" onclick="changeTab(0)">Game 1</button>
        <button class="tab-button" onclick="changeTab(1)">Game 2</button>
        <button class="tab-button" onclick="changeTab(2)">Game 3</button>
    </div>
    <div class="tab-content active">
        <!-- <div class="input-container"><button id="play-button">Play/Pause Key Centers w.r.t. Reference Note</button></p></div> -->

        <div class="input-container">
            <label for="ressynthvol-slider">Resolution Note Volume:</label>
            <input type="range" id="ressynthvol-slider" name="ressynthvol" min="-10" max="10" value ="-6" oninput="ressynthvol(this)">
        </div>  
        <div class="input-container">
            <label for="ref-count-input">Rounds for Each Reference Note</label>
            <select id="ref-count-input" onchange="changeRefCont(this);">
                <option value="0" selected>Keep Static</option>
                <option value="1">3</option>
                <option value="3">3</option>
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="25">25</option>
            </select>
        </div>  
    </div>
    <div class="tab-content">
        <!-- <div class="input-container"><p><button id="melody-button">Play/Pause Melody w.r.t. Key Centers</button></p></div> -->
        <!-- removed melody duration slider -->

        <!-- <p><label for="mel-duration-slider">Duration:</label>
            <select id="mel-duration-slider" oninput="melduration(this)">
                <option value="2n" selected>2</option>
                <option value="4n">4</option>
                <option value="5n">8</option>
            </select></p> -->

        <div class="input-container">
            <label for="re-base-input">Rounds Before Returning to Initial Key</label>
            <select id="re-base-input" onchange="changeInitialStateRounds(this);">
                <option value="1">1</option>
                <option value="2" selected>2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
        </div>

        <div class="input-container">
            <label for="num-base-returns-input">New Melody After Returning to Initial Key</label>
            <select id="num-base-returns-input" onchange="changeMelodyRounds(this);">
                <option value="1">1</option>
                <option value="2" selected>2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select> Time(s) 
        </div>  

    </div>
    <div class="tab-content">
        <div class="input-container">
            <fieldset>
                <legend>Mode Select:</legend>
                <input type="checkbox" id="Ionian" name="modes" value="0" onchange="modeUpdateFunction();" checked>
                <label for="Ionian">Ionian</label>
                <input type="checkbox" id="Dorian" name="modes" value="1" onchange="modeUpdateFunction();" checked>
                <label for="Dorian">Dorian</label>
                <input type="checkbox" id="Phrygian" name="modes" value="2" onchange="modeUpdateFunction();" checked>
                <label for="Phrygian">Phrygian</label>
                <input type="checkbox" id="Lydian" name="modes" value="3" onchange="modeUpdateFunction();" checked>
                <label for="Lydian">Lydian</label><br>
                <input type="checkbox" id="Mixolydian" name="modes" value="4" onchange="modeUpdateFunction();" checked>
                <label for="Mixolydian">Mixolydian</label>
                <input type="checkbox" id="Aeolian" name="modes" value="5" onchange="modeUpdateFunction();" checked>
                <label for="Aeolian">Aeolian</label>
                <input type="checkbox" id="Locrian" name="modes" value="6" onchange="modeUpdateFunction();" checked>
                <label for="Locrian">Locrian</label><br>
            </fieldset>
        </div>
        <br>
        <div class="input-container">
            <label for="num-mel-rounds-input">Rounds Before Randomizing Melody</label>
            <select id="num-mel-rounds-input" onchange="changeMelodyModeRounds(this);">
                <option value="1">1</option>
                <option value="2" selected>2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
            </select>
        </div> 

    </div>
    <br>
    <div class="section-divider"></div>
    <br>
    <div class="input-container">
        <label for="speak-solfege-checkbox">Speak Hints:</label>
        <input type="checkbox" id="speak-solfege-checkbox" onchange="speaksolfege(this)" checked>
    </div>
    <div class="input-container">
        <label for="tempo-slider">Adjust tempo (stops current game):</label>
        <input type="range" id="tempo-slider" name="tempo" min="60" max="280" value="180" onchange="updateBPM(this)">
    </div>
    <div class="sub-section-divider"></div>
    <div class="input-container">
        <label for="chordsynthvol-slider">Key Volume:</label>
        <input type="range" id="chordsynthvol-slider" name="chordsynthvol" min="-10" max="10" value="-2" oninput="chordsynthvol(this)">
    </div>
    <div class="input-container">
        <label for="refsynthvol-slider">Solfege/Melody Note Volume:</label>
        <input type="range" id="refsynthvol-slider" name="refsynthvol" min="-10" max="10" value="-2" oninput="refsynthvol(this)">
    </div>
    <div class="input-container">
        <label for="mel-duration-slider">Melody Note Duration:</label>
        <input type="range" id="mel-duration-slider" name="mel-duration-slider" min="0" max="100" value="25" oninput="melduration(this);">
    </div>
    <div class="sub-section-divider"></div>
    <div class="input-container">
        <label for="num-notes-seq-input">Number of Notes in Melody</label>
        <select id="num-notes-seq-input">
            <!-- <option value="0">N/A</option> -->
            <option value="1">1</option>
            <option value="2" selected>2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select>
    </div>
    <div class="input-container">
        <label for="scenario-input">Repeat Each Scenario</label>
        <select id="scenario-input" onchange="changeScenarioRounds(this);">
            <option value="1">1</option>
            <option value="2" selected>2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select> Time(s)
    </div>
    <div class="input-container">
        <label for="musical-notes">Update reference note or key (depending on game):</label>
        <select id="ref-note" name="ref-note" onchange="updateRefNote(this)">
            <option value="C" selected>C</option>
            <option value="C#">C#</option>
            <option value="D">D</option>
            <option value="D#">D#</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="F#">F#</option>
            <option value="G">G</option>
            <option value="G#">G#</option>
            <option value="A">A</option>
            <option value="A#">A#</option>
            <option value="B">B</option>
        </select>
    </div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.32/Tone.js"></script>

<script src="https://cdn.jsdelivr.net/npm/tonal/browser/tonal.min.js"></script>

<script src="music.js"></script>
<script>

    function toggleNote(index, keyElement) {
        // console.log('Playing note:', note);
        global_scaleNotes[index][4] = !global_scaleNotes[index][4];

        // Toggle the active class to change the color of the clicked key
        keyElement.classList.toggle('active');
    }

    function updateRefNote(selectElement) {
        global_refNote = selectElement.value + '4'; // later, add option to randomize selection of octave
    }

    function updateBPM(sliderElement) {
        resetPlayer();
        global_bpm = sliderElement.value;
    }

    function refsynthvol(t) { global_solfegeSynth.volume.value = t.value;}
    function ressynthvol(t) { global_resolutionSynth.volume.value = t.value;}
    function melduration(t) { global_melodyNoteDuration = t.value/100.0;}
    function speaksolfege(t) { global_speakSolfege = t.checked;}

    function changeRefCont(t) { global_referenceNoteChanges = t.value;}

    function changeInitialStateRounds(t) { global_roundsToInitialState = t.value;}

    function chordsynthvol(t) { global_keySynth.volume.value = t.value;}
    function changeScenarioRounds(t) { global_scenarioRepeats = t.value;}
    function changeMelodyRounds(t) { global_totalRoundsToRandomizeMelody = t.value;}
    function changeInitialStateRounds(t) { global_roundsToInitialState = t.value;}

    function changeMelodyModeRounds(t) { global_totalRoundsToRandomizeModeMelody = t.value;}
    function modeUpdateFunction() {global_selectedModes = Array.from(document.querySelectorAll('input[name="modes"]:checked')).map(input => input.value);}
    function changeTab(tabIndex) {
        // Get all tab buttons and tab contents
        var tabButtons = document.querySelectorAll('.tab-button');
        var tabContents = document.querySelectorAll('.tab-content');

        // Remove the 'active' class from all tab buttons and tab contents
        for (var i = 0; i < tabButtons.length; i++) {
            tabButtons[i].classList.remove('active');
            tabContents[i].classList.remove('active');
        }

        // resetPlayer();

    // Add the 'active' class to the selected tab button and tab content
    tabButtons[tabIndex].classList.add('active');
    tabContents[tabIndex].classList.add('active');

    switch (tabIndex) {
        case 0:
            global_currentGame = "changingSolfege";
            break;
        case 1:
            global_currentGame = "staticSolfege";
            break;
        case 2:
            global_currentGame = "modeMelodies";
            break;
    }
}
</script>

</html>

